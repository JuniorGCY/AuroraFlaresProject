<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chapter 3</title>
  <style>
    html,body{
      margin:0;height:100%;background:#000;color:#e5e7eb;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",sans-serif;
      overflow:hidden
    }
    #bgVideoWrap{
      position:fixed;inset:0;z-index:0;pointer-events:none;
      background:#000;opacity:0;transition:opacity .5s ease
    }
    #bgVideoWrap.show{opacity:1}
    #bgVideo{
      width:100%;height:100%;
      object-fit:cover;display:block;background:#000
    }
    #wrap{position:fixed;inset:0;z-index:10;transition:opacity .45s ease}
    #wrap.fade{opacity:0}
    canvas{position:absolute;inset:0;width:100%;height:100%;display:block;border:0}

    #hud{
      position:fixed;right:10px;top:10px;z-index:40;
      background:rgba(0,0,0,.55);border:1px solid #334155;border-radius:10px;
      padding:6px 9px;font:12px/1.3 system-ui;max-width:60ch;white-space:pre-wrap
    }
    #decolarBtn{
      position:fixed;left:50%;bottom:32px;transform:translateX(-50%) scale(.98);
      z-index:50;border:1px solid #334155;border-radius:999px;padding:12px 20px;
      background:linear-gradient(180deg,#111827,#0b1220);color:#e5e7eb;
      font-weight:600;letter-spacing:.2px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.35);
      transition:transform .2s ease,filter .2s ease,opacity .25s ease;
      display:inline-flex;align-items:center;gap:8px;pointer-events:auto;

      
      opacity:0; pointer-events:none;
    }
    #decolarBtn.show{
      opacity:1; transform:translateX(-50%) scale(1);
      pointer-events:auto;
    }
    #decolarBtn:hover{filter:brightness(1.06)}
    #decolarBtn:active{transform:translateX(-50%) scale(.98)}
    #decolarBtn[disabled]{opacity:.6;cursor:default}
    #decolarBtn svg{width:18px;height:18px;display:block}
  </style>
</head>
<body>
  
  <div id="bgVideoWrap" aria-hidden="true">
    <video id="bgVideo" preload="auto" muted playsinline aria-hidden="true">
     
      <source src="../../../assets/videos/takeoff.mp4" type="video/mp4">
    </video>
  </div>

  <div id="wrap" aria-label="Cena Spline">
    <canvas id="splineCanvas"></canvas>
    <div id="hud">Loading…</div>
    <button id="decolarBtn" type="button" aria-label="Entrar no castelo" disabled>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M5 15c-1.657 0-3 1.343-3 3 0 .552.448 1 1 1 .552 0 1-.448 1-1 0-.552.448-1 1-1 .552 0 1-.448 1-1s-.448-1-1-1Zm6.586-6.586a2 2 0 0 1 2.828 0l1.172 1.172a2 2 0 0 1 0 2.828l-6.95 6.95a2 2 0 0 1-1.414.586H6a1 1 0 0 1-1-1v-1.222a2 2 0 0 1 .586-1.414l6.95-6.95Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M14 4.5c2.9 0 5.5.7 7.5 2.5-1.8 2-2.5 4.6-2.5 7.5M9.5 10C9.5 7.1 10.2 4.5 12 2.5"/>
      </svg>
      Enter the castle
    </button>
  </div>

  <script type="module">
    (async () => {
      const SCENE_URL = 'https://prod.spline.design/HsZdu6sF87u5yKSA/scene.splinecode';
      const GAME_URL  = '../03/index.html';
      const BUTTON_DELAY_MS = 10000;

      const hud = document.getElementById('hud');
      const wrap = document.getElementById('wrap');
      const btn  = document.getElementById('decolarBtn');

      const bgWrap  = document.getElementById('bgVideoWrap');
      const bgVideo = document.getElementById('bgVideo');

      const log = (m)=>{ hud.textContent = String(m); console.log('[app]', m); };

      let app;
      try {
        const { Application } = await import('https://unpkg.com/@splinetool/runtime@1.9.36/build/runtime.js');
        const canvas = document.getElementById('splineCanvas');

        function resizeCanvasToDisplaySize(c){
          const dpr = Math.min(window.devicePixelRatio || 1, 2);
          const w = Math.floor(c.clientWidth  * dpr);
          const h = Math.floor(c.clientHeight * dpr);
          if (c.width !== w || c.height !== h) { c.width = w; c.height = h; }
        }
        function fit(){ resizeCanvasToDisplaySize(canvas); try{ app?.resize?.(); }catch{} }
        new ResizeObserver(fit).observe(canvas);
        window.addEventListener('resize', fit);

        app = new Application(canvas);
        const bust = SCENE_URL + (SCENE_URL.includes('?')?'&':'?') + '_cb=' + Date.now();
        log('Downloading Spline scene…');
        await app.load(bust);
        fit();
        log('Loading scene. Please wait…');
      } catch (err) {
        console.error('Error loading Spline:', err);
        log('Failed to load Spline. Please wait…');
      }

      async function autoStartVideo(){
        try {
          bgWrap.classList.add('show');
          bgVideo.muted = true;
          bgVideo.playsInline = true;
          bgVideo.setAttribute('playsinline','');
          bgVideo.setAttribute('webkit-playsinline','');
          await bgVideo.play().catch(()=>{ /* se bloquear, segue sem áudio/sem play */ });
        } catch {}
      }
      autoStartVideo();

      setTimeout(()=>{
        btn.disabled = false;
        btn.classList.add('show');
        log('Ready. Enter the castle whenever you want.');
      }, BUTTON_DELAY_MS);

      btn.addEventListener('click', ()=>{
        window.location.href = GAME_URL;
      });

      document.addEventListener('keydown', (ev)=>{
        if (ev.key === 'Enter' && !btn.disabled) btn.click();
      });
    })();
  </script>
</body>
</html>
