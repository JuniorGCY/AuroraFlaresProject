<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chapter 4</title>
  <style>
    html,body{
      margin:0;height:100%;background:#000;overflow:hidden;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",sans-serif
    }
    #wrap{position:fixed;inset:0}
    #vid{
      position:absolute;inset:0;width:100%;height:100%;
      object-fit:cover;background:#000;display:block
    }
    #tapOverlay{
      position:fixed;inset:0;display:none;place-items:center;z-index:5;
      background:rgba(0,0,0,.55);color:#e5e7eb;text-align:center
    }
    .tapBox{
      border:1px solid #334155;border-radius:14px;padding:18px 22px;
      background:rgba(0,0,0,.35);box-shadow:0 8px 32px rgba(0,0,0,.5)
    }
    .tapSmall{font-size:12px;color:#9ca3af;margin-top:6px}
  </style>
</head>
<body>
  <div id="wrap" aria-label="Cinemática">
    <video id="vid" preload="auto" muted playsinline></video>
  </div>

  <div id="tapOverlay" role="button" tabindex="0" aria-label="Iniciar vídeo">
    <div class="tapBox">
      Tap to start the video
      <div class="tapSmall">Some devices require user interaction</div>
    </div>
  </div>

  <script type="module">
    const VIDEO_SRC = '../../../assets/videos/Cap4Final.mp4';
    const NEXT_URL  = '../05/index.html';
    const MAX_FALLBACK_MS = 150 * 60 * 1000;

    const video = document.getElementById('vid');
    const tapOverlay = document.getElementById('tapOverlay');

    function goNext(){ window.location.href = NEXT_URL; }

    async function playAuto(){
      const src = VIDEO_SRC + (VIDEO_SRC.includes('?') ? '&' : '?') + '_cb=' + Date.now();
      video.src = src;
      video.muted = true;
      video.playsInline = true;
      video.setAttribute('playsinline','');
      video.setAttribute('webkit-playsinline','');

      try {
        await video.play();
      } catch (err) {
        tapOverlay.style.display = 'grid';
      }
    }

    const startOnTap = async () => {
      tapOverlay.style.display = 'none';
      try {
        video.muted = false;
        await video.play();
      } catch (e) {
        video.muted = true;
        try { await video.play(); } catch {}
      }
    };
    tapOverlay.addEventListener('click', startOnTap);
    tapOverlay.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') startOnTap(); });

    video.addEventListener('ended', goNext);

    setTimeout(goNext, MAX_FALLBACK_MS);

    document.addEventListener('visibilitychange', ()=>{
      if (document.hidden) { try { video.pause(); } catch {} }
      else { try { video.play(); } catch {} }
    });
    
    playAuto();
  </script>
</body>
</html>
